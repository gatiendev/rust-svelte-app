Here’s how to test your Rust authentication API using `curl`. The API should have the following endpoints:

- `POST /register` – create a new user  
- `POST /login` – authenticate and receive a session cookie  
- `GET /profile` – a protected endpoint that returns user info (if you implemented it)  
- `POST /logout` – destroy the session

We’ll use a cookie jar file (`cookies.txt`) to persist the session across requests.

---

## 1. Register a New User

```bash
curl -X POST http://localhost:8080/register \
  -H "Content-Type: application/json" \
  -d '{"username":"alice","password":"secret123"}'
```

**Expected response (success):**

```json
{"user_id":"550e8400-e29b-41d4-a716-446655440000"}
```

If the username is already taken, you'll get a 409 Conflict with a plain text message.

---

## 2. Log In and Save the Session Cookie

```bash
curl -X POST http://localhost:8080/login \
  -H "Content-Type: application/json" \
  -d '{"username":"alice","password":"secret123"}' \
  -c cookies.txt
```

The `-c cookies.txt` option saves the `Set-Cookie` header into a file named `cookies.txt`.  
**Expected response:** `"Logged in"` (plain text) with HTTP 200.

You can inspect the saved cookie with `cat cookies.txt`.

---

## 3. Access a Protected Endpoint (e.g., `/profile`)

If you have a `GET /profile` handler that returns user information:

```bash
curl -X GET http://localhost:8080/profile \
  -b cookies.txt
```

The `-b cookies.txt` sends the previously saved cookie along with the request.  
**Expected response (example):**

```json
{"user_id":"550e8400-e29b-41d4-a716-446655440000","username":"alice","message":"Welcome to your profile"}
```

Without a valid cookie, you should receive a 401 Unauthorized.

---

## 4. Log Out

```bash
curl -X POST http://localhost:8080/logout -b cookies.txt -c cookies.txt
```

**Expected response:** `"Logged out"`.  
After logout, the cookie on the server side is invalidated. If you try to access `/profile` again with the same cookie, it should be rejected.

---

## Testing Without Saving to a File (Manual Cookie Handling)

You can also capture the cookie from the login response and reuse it in subsequent requests without a file. For example:

**Step 1 – Login and capture cookie:**

```bash
curl -X POST http://localhost:8080/login \
  -H "Content-Type: application/json" \
  -d '{"username":"alice","password":"secret123"}' \
  -i 2>&1 | grep -i set-cookie
```

Copy the cookie value (e.g., `auth-session=...`).

**Step 2 – Access protected endpoint using the copied cookie:**

```bash
curl -X GET http://localhost:8080/profile \
  -H "Cookie: auth-session=..."
```

But using a cookie jar file is much easier.

---

## Testing Script (Optional)

Save the following as `test.sh` and run `bash test.sh`:

```bash
#!/bin/bash

BASE_URL="http://localhost:8080"
COOKIE_JAR="cookies.txt"

# Register
echo "--- Registering user ---"
curl -s -X POST "$BASE_URL/register" \
  -H "Content-Type: application/json" \
  -d '{"username":"alice","password":"secret123"}' \
  | jq .

# Login
echo "--- Logging in ---"
curl -s -X POST "$BASE_URL/login" \
  -H "Content-Type: application/json" \
  -d '{"username":"alice","password":"secret123"}' \
  -c "$COOKIE_JAR"

# Profile
echo "--- Accessing profile ---"
curl -s -X GET "$BASE_URL/profile" \
  -b "$COOKIE_JAR" \
  | jq .

# Logout
echo "--- Logging out ---"
curl -s -X POST "$BASE_URL/logout" \
  -b "$COOKIE_JAR"

# Try profile again (should fail)
echo "--- Accessing profile after logout ---"
curl -s -X GET "$BASE_URL/profile" \
  -b "$COOKIE_JAR" \
  -w "\nHTTP Status: %{http_code}\n"

rm "$COOKIE_JAR"
```

**Note:** This script assumes you have `jq` installed for pretty JSON output. If not, remove `| jq .` or install jq (`sudo apt install jq`).

---

## Troubleshooting

- If you get `Connection refused`, make sure the Rust service is running and port 8080 is correctly mapped in Docker.
- If a request returns `404 Not Found`, double‑check the endpoint URL and that the service registered the routes correctly.
- If the cookie isn't being sent or accepted, ensure you're using the same cookie file for all requests and that the cookie name matches what your server uses (default `auth-session`).

Let me know if you encounter any issues!
