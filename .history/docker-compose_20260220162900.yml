version: '3.8'

services:
  go_api:
    build:
      context: ./go_api
      dockerfile: Dockerfile
    ports:
      - "8000:8000"
    restart: unless-stopped
    environment:
      # Add any environment variables your app needs here
      - GIN_MODE=release
    # - DATABASE_URL=postgres://user:pass@db:5432/mydb
    # Optional: add health check
    dns:
      - 8.8.8.8 
    
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:8000/health"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 5s
    networks:
      - app-network
  # If you need a database, uncomment the following:
  # depends_on:
  #   - db
  # networks:
  #   - backend
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
      args:
        VITE_WS_URL: ws://go_api:8000/ws 
    ports:
      - "5173:5173"              # Public facing
    volumes:
    - ./frontend:/app          # Mount source code
    - /app/node_modules         # Prevent overwriting node_modules
    depends_on:
      - go_api
    networks:
      - app-network
    restart: unless-stopped

networks:
  app-network:
    driver: bridge

# Uncomment if you need a PostgreSQL database
#   db:
#     image: postgres:15-alpine
#     environment:
#       POSTGRES_USER: user
#       POSTGRES_PASSWORD: pass
#       POSTGRES_DB: mydb
#     volumes:
#       - pgdata:/var/lib/postgresql/data
#     ports:
#       - "5432:5432"
#     restart: unless-stopped
#     healthcheck:
#       test: ["CMD-SHELL", "pg_isready -U user -d mydb"]
#       interval: 10s
#       timeout: 5s
#       retries: 5

# volumes:
#   pgdata: